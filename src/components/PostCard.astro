---
import { translateCategory } from '../lib/utils';
import { base, assetPath, getCategoryI18n } from '../lib/config';

interface Props {
  title: string;
  description: string;
  date: Date;
  slug: string;
  tags?: string[];
  category?: string;
  coverImage?: string;
  index?: number;
  compact?: boolean;
}

const { title, description, date, slug, tags = [], category, coverImage, index = 0, compact = false } = Astro.props;
const catI18n = getCategoryI18n();

const formattedDate = date.toLocaleDateString('ko-KR', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
});
const formattedDateEn = date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
});

const categoryEn = category ? translateCategory(category, catI18n) : '';

const parentCat = category ? category.split('/')[0] : '';
---

<article class="group">
  <a href={`${base}/blog/${slug}`} class="block glass-card rounded-xl sm:rounded-2xl overflow-hidden h-full">
    {/* Cover image */}
    <div class="aspect-[16/10] w-full bg-gradient-to-br from-gray-100 to-gray-50 dark:from-gray-800/50 dark:to-gray-900/50 relative overflow-hidden">
      {coverImage && (
        <img
          src={assetPath(coverImage)}
          alt=""
          class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700 ease-out absolute inset-0"
          loading="lazy"
          onerror="this.style.display='none'"
        />
      )}
      <div class="w-full h-full flex items-center justify-center">
        <svg class="w-10 h-10 text-gray-200 dark:text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="0.8">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
      </div>
    </div>

    {/* Content */}
    <div class="p-4 sm:p-5">
      <h3 class="text-[14px] sm:text-[15px] font-semibold leading-snug tracking-[-0.01em] group-hover:text-primary dark:group-hover:text-primary-light transition-colors duration-300 mb-1.5 line-clamp-2">
        {title}
      </h3>
      <p class="text-[12px] sm:text-[13px] text-gray-500 dark:text-gray-400 leading-relaxed line-clamp-2 mb-4">
        {description}
      </p>
      <div class="flex items-center justify-between mt-auto">
        <div class="flex items-center gap-2 text-[10px] sm:text-[11px] text-gray-400 dark:text-gray-500">
          <time class="tracking-wider" data-ko={formattedDate} data-en={formattedDateEn}>{formattedDate}</time>
          {category && (
            <>
              <span class="w-0.5 h-0.5 rounded-full bg-gray-300 dark:bg-gray-600" />
              <span data-ko={category} data-en={categoryEn}>{category}</span>
            </>
          )}
        </div>
      </div>
    </div>
  </a>
</article>
