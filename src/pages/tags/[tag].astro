---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  const tags = new Set<string>();
  posts.filter(p => !p.data.draft).forEach((post) => {
    post.data.tags.forEach((tag) => tags.add(tag));
  });

  return [...tags].map((tag) => ({
    params: { tag },
    props: {
      tag,
      posts: posts
        .filter((post) => !post.data.draft && post.data.tags.includes(tag))
        .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf()),
    },
  }));
}

const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const { tag, posts } = Astro.props;
---

<BaseLayout title={`Tag: ${tag}`}>
  <div class="fade-in-up">
    <a href={`${base}/tags`} class="group inline-flex items-center gap-1.5 text-[12px] sm:text-[13px] text-gray-400 dark:text-gray-500 hover:text-primary dark:hover:text-primary-light transition-all duration-300 mb-6 sm:mb-8">
      <svg class="w-3.5 h-3.5 group-hover:-translate-x-1 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
      </svg>
      <span data-ko="모든 태그" data-en="All Tags">모든 태그</span>
    </a>

    <div class="flex items-center gap-3 mb-2 px-1">
      <h1 class="text-xl sm:text-2xl font-bold tracking-tight">
        <span class="gradient-text"># {tag}</span>
      </h1>
    </div>
    <p class="text-[12px] sm:text-[13px] text-gray-400 dark:text-gray-500 mb-8 sm:mb-10 px-1">
      {posts.length}<span data-ko="개의 글" data-en=" posts">개의 글</span>
    </p>
  </div>

  <div class="space-y-3 stagger">
    {posts.map((post: any, i: number) => (
      <PostCard
        title={post.data.title}
        description={post.data.description}
        date={post.data.date}
        slug={post.id}
        tags={post.data.tags}
        coverImage={post.data.coverImage}
        index={i}
      />
    ))}
  </div>
</BaseLayout>
