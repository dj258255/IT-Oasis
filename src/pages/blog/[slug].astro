---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogSidebar from '../../components/BlogSidebar.astro';
import { getCollection, render } from 'astro:content';
import { getReadingTime, parseCategory, splitContent } from '../../lib/utils';

export async function getStaticPaths() {
  const posts = (await getCollection('blog'))
    .filter((p) => !p.data.draft)
    .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

  return posts.map((post, index) => {
    const parentCat = parseCategory(post.data.category).parent;
    const relatedPosts = posts
      .filter((p) => p.id !== post.id && parseCategory(p.data.category).parent === parentCat)
      .slice(0, 4);

    return {
      params: { slug: post.id },
      props: {
        post,
        prevPost: posts[index + 1] || null,
        nextPost: posts[index - 1] || null,
        relatedPosts,
      },
    };
  });
}

const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const { post, prevPost, nextPost, relatedPosts } = Astro.props;
const { Content, headings } = await render(post);
const readingTime = getReadingTime(post.body || '');
const { en: enBody } = splitContent(post.body || '');
const hasEn = enBody !== null;
const titleEn = post.data.titleEn || '';
const descriptionEn = post.data.descriptionEn || '';

const formattedDate = post.data.date.toLocaleDateString('ko-KR', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const tocHeadings = headings.filter((h) => h.depth <= 3);
const hasToc = tocHeadings.length > 2;

// Split headings into ko/en groups for bilingual TOC
let koHeadingCount = tocHeadings.length;
if (hasEn) {
  const delimIdx = (post.body || '').indexOf('<!-- EN -->');
  if (delimIdx !== -1) {
    const koSection = (post.body || '').slice(0, delimIdx);
    const matches = koSection.match(/^#{1,3}\s/gm);
    koHeadingCount = matches ? matches.length : 0;
  }
}

const tagColors = ['tag-violet', 'tag-cyan', 'tag-rose', 'tag-emerald', 'tag-amber'];
const catColorMap: Record<string, string> = {
  '개발': 'cat-dev',
  '일상': 'cat-life',
};
---

<BaseLayout title={post.data.title} description={post.data.description} ogImage={post.data.coverImage}>
  <div class="fade-in-up">
      <!-- Main content -->
      <article class="post-article relative">
      <!-- Floating left sidebar (outside content area, like TOC on right) -->
      <div class="floating-sidebar hidden xl:block">
        <BlogSidebar />
      </div>
      <!-- Back link -->
      <a href="/blog" class="group inline-flex items-center gap-1.5 text-[12px] sm:text-[13px] text-gray-400 dark:text-gray-500 hover:text-primary dark:hover:text-primary-light transition-all duration-300 mb-8 sm:mb-10">
        <svg class="w-3.5 h-3.5 group-hover:-translate-x-1 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
        <span data-ko="모든 글" data-en="All Posts">모든 글</span>
      </a>

      <!-- Post header -->
      <header class="mb-8 sm:mb-10">
        <div class="flex flex-wrap items-center gap-2 sm:gap-3 mb-4 sm:mb-5">
          <time class="text-[11px] sm:text-[12px] font-medium text-gray-400 dark:text-gray-500 tracking-wider uppercase">
            {formattedDate}
          </time>
          <span class="w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600"></span>
          <span class="text-[11px] sm:text-[12px] text-gray-400 dark:text-gray-500">{readingTime}<span data-ko="분 읽기" data-en="min read">분 읽기</span></span>
          <span class="w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600"></span>
          <a href={`${base}/categories/${encodeURIComponent(post.data.category)}`} class:list={['category-pill', catColorMap[parseCategory(post.data.category).parent] || 'cat-default']}>
            {post.data.category}
          </a>
        </div>
        <h1 id="post-title" class="text-xl sm:text-2xl md:text-3xl font-bold tracking-[-0.02em] leading-tight mb-4 sm:mb-5">
          {post.data.title}
        </h1>
        <div class="flex flex-wrap items-center gap-1.5">
          {post.data.tags.length > 0 && (
            post.data.tags.map((tag: string, i: number) => (
              <a href={`${base}/tags/${encodeURIComponent(tag)}`} class:list={['tag-pill text-[10px] sm:text-[11px]', tagColors[i % tagColors.length]]}>
                {tag}
              </a>
            ))
          )}
          {hasEn && (
            <span class="lang-badge ml-1">
              <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
              </svg>
              KO/EN
            </span>
          )}
        </div>
      </header>

      <!-- Cover image -->
      {post.data.coverImage && (
        <div class="mb-8 sm:mb-10 rounded-2xl overflow-hidden">
          <img src={post.data.coverImage} alt="" class="w-full h-64 sm:h-80 md:h-96 object-cover" loading="lazy" />
        </div>
      )}

      <!-- Divider -->
      <div class="divider mb-8 sm:mb-10"></div>

      <!-- Inline TOC (mobile only when sidebar exists) -->
      {hasToc && (
        <details class="xl:hidden glass-card rounded-2xl p-6 mb-8 group" open>
          <summary class="flex items-center justify-between cursor-pointer text-[14px] font-semibold select-none">
            <div class="flex items-center gap-2">
              <svg class="w-4 h-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
              </svg>
              <span data-ko="목차" data-en="Table of Contents">목차</span>
            </div>
            <svg class="w-4 h-4 text-gray-400 transform group-open:rotate-180 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </summary>
          <nav class="mt-4 space-y-1.5">
            {tocHeadings.map((heading, idx) => (
              <a
                href={`#${heading.slug}`}
                data-lang={hasEn ? (idx < koHeadingCount ? 'ko' : 'en') : undefined}
                class:list={[
                  'toc-item block text-[13px] text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary-light transition-colors duration-300 py-1',
                  heading.depth === 3 && 'pl-4',
                  hasEn && idx >= koHeadingCount && 'hidden',
                ]}
              >
                {heading.text}
              </a>
            ))}
          </nav>
        </details>
      )}

      <!-- Post content -->
      <div class="glass-gradient rounded-2xl sm:rounded-3xl p-5 sm:p-7 md:p-10">
        <div id="post-content" class="prose" data-has-en={hasEn ? 'true' : 'false'} data-title-en={titleEn}>
          <Content />
        </div>
      </div>

      <!-- Author profile -->
      <div class="author-card mt-10 sm:mt-14">
        <div class="flex flex-col sm:flex-row items-center sm:items-start gap-6 sm:gap-8 p-6 sm:p-8 md:p-10">
          <div class="w-28 h-28 sm:w-32 sm:h-32 rounded-full overflow-hidden shrink-0 bg-gradient-to-br from-primary/20 via-accent/15 to-rose/20">
            <img src={`${base}/avatar.png`} alt="Author" class="w-full h-full object-cover" onerror="this.style.display='none'" />
          </div>
          <div class="flex-1 min-w-0 text-center sm:text-left">
            <div class="flex items-center justify-center sm:justify-start gap-2.5 mb-3">
              <span class="text-[12px] sm:text-[13px] text-gray-400 dark:text-gray-500 tracking-wider uppercase">Written by</span>
              <span class="text-[12px] sm:text-[13px] font-bold px-2.5 py-0.5 rounded-lg bg-primary/10 text-primary dark:bg-primary-light/10 dark:text-primary-light">@IT Oasis</span>
            </div>
            <p class="text-[13px] sm:text-[14px] text-gray-500 dark:text-gray-400 leading-relaxed mb-5" data-ko="풍부한 상상과 호기심으로 다양한 프로젝트를 만들어갑니다." data-en="Creating diverse projects with rich imagination and curiosity.">
              풍부한 상상과 호기심으로 다양한 프로젝트를 만들어갑니다.
            </p>
            <div class="flex items-center justify-center sm:justify-start gap-2">
              <a href="https://github.com" target="_blank" rel="noopener" class="author-social-btn" aria-label="GitHub">
                <svg class="w-[18px] h-[18px]" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
              </a>
              <a href="mailto:contact@example.com" class="author-social-btn" aria-label="Email">
                <svg class="w-[18px] h-[18px]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Related posts -->
      {relatedPosts.length > 0 && (
        <div class="related-card mt-6 sm:mt-8">
          <div class="p-6 sm:p-8 md:p-10">
            <p class="text-[15px] sm:text-[16px] font-bold tracking-tight mb-5">
              <span class="text-gray-500 dark:text-gray-400">'스토리 - {parseCategory(post.data.category).parent}'</span>
              <span class="text-gray-400 dark:text-gray-500" data-ko=" 의 다른 글" data-en="'s other posts"> 의 다른 글</span>
            </p>
            <div class="divider mb-5"></div>
            <div class="space-y-0">
              {relatedPosts.map((rp) => (
                <a href={`${base}/blog/${rp.id}`} class="related-post-link group flex items-center justify-between gap-6">
                  <p class="text-[14px] sm:text-[15px] font-semibold group-hover:text-primary dark:group-hover:text-primary-light transition-colors duration-300 truncate">
                    {rp.data.title}
                  </p>
                  <span class="text-[18px] text-gray-300 dark:text-gray-600 group-hover:text-primary dark:group-hover:text-primary-light group-hover:translate-x-1 transition-all duration-300 shrink-0 leading-none">&rarr;</span>
                </a>
              ))}
            </div>
          </div>
        </div>
      )}

      <!-- Prev / Next navigation -->
      {(prevPost || nextPost) && (
        <nav class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-3">
          {prevPost ? (
            <a href={`${base}/blog/${prevPost.id}`} class="glass-card rounded-2xl p-5 group block">
              <span class="text-[11px] text-gray-400 dark:text-gray-500 tracking-widest uppercase flex items-center gap-1 mb-2">
                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                </svg>
                <span data-ko="이전 글" data-en="Previous">이전 글</span>
              </span>
              <span class="text-[14px] font-medium group-hover:text-primary transition-colors duration-300 line-clamp-1">
                {prevPost.data.title}
              </span>
            </a>
          ) : <div />}
          {nextPost ? (
            <a href={`${base}/blog/${nextPost.id}`} class="glass-card rounded-2xl p-5 group block text-right">
              <span class="text-[11px] text-gray-400 dark:text-gray-500 tracking-widest uppercase flex items-center justify-end gap-1 mb-2">
                <span data-ko="다음 글" data-en="Next">다음 글</span>
                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                </svg>
              </span>
              <span class="text-[14px] font-medium group-hover:text-primary transition-colors duration-300 line-clamp-1">
                {nextPost.data.title}
              </span>
            </a>
          ) : <div />}
        </nav>
      )}

      <!-- Sidebar TOC (desktop only, floating right of article) -->
      {hasToc && (
        <aside class="hidden xl:block floating-toc">
          <div class="sticky top-24">
            <div class="glass-sidebar p-5">
              <div class="flex items-center gap-2 mb-4">
                <svg class="w-3.5 h-3.5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                </svg>
                <span class="text-[12px] font-semibold tracking-wide uppercase text-gray-400 dark:text-gray-500" data-ko="목차" data-en="TOC">목차</span>
              </div>

              <!-- Progress bar -->
              <div class="h-px w-full bg-gray-200/50 dark:bg-gray-700/30 mb-4 rounded-full overflow-hidden">
                <div id="toc-progress" class="h-full bg-gradient-to-r from-primary to-accent rounded-full transition-all duration-300" style="width: 0%"></div>
              </div>

              <nav id="sidebar-toc" class="space-y-0.5">
                {tocHeadings.map((heading, idx) => (
                  <a
                    href={`#${heading.slug}`}
                    data-heading={heading.slug}
                    data-lang={hasEn ? (idx < koHeadingCount ? 'ko' : 'en') : undefined}
                    class:list={[
                      'toc-link block text-[12px] leading-relaxed py-1 rounded-lg transition-all duration-300 text-gray-400 dark:text-gray-500 hover:text-primary dark:hover:text-primary-light',
                      heading.depth === 2 && 'pl-2',
                      heading.depth === 3 && 'pl-5',
                      hasEn && idx >= koHeadingCount && 'hidden',
                    ]}
                  >
                    {heading.text}
                  </a>
                ))}
              </nav>
            </div>
          </div>
        </aside>
      )}
    </article>
  </div>
</BaseLayout>

<style>
  .lang-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    padding: 0.2rem 0.65rem;
    border-radius: 9999px;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.03em;
    border: 1px solid rgba(56, 189, 248, 0.25);
    background: rgba(56, 189, 248, 0.06);
    color: rgb(56, 189, 248);
    user-select: none;
  }

  :global(.dark) .lang-badge {
    border-color: rgba(14, 165, 233, 0.25);
    background: rgba(14, 165, 233, 0.08);
    color: rgb(14, 165, 233);
  }

  :global(.lang-content) {
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  :global(.lang-content.lang-hidden) {
    display: none;
  }

  :global(.lang-content.fade-in) {
    animation: langFadeIn 0.3s ease forwards;
  }

  @keyframes langFadeIn {
    from {
      opacity: 0;
      transform: translateY(4px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .related-post-link {
    padding: 0.75rem 1rem;
    border-radius: 14px;
    transition: all 0.3s ease;
  }

  .related-post-link:hover {
    background: rgba(56, 189, 248, 0.04);
  }

  :global(.dark) .related-post-link:hover {
    background: rgba(56, 189, 248, 0.06);
  }

  .author-card {
    background: rgba(255, 255, 255, 0.45);
    border: 1px solid rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(20px) saturate(1.4);
    -webkit-backdrop-filter: blur(20px) saturate(1.4);
    border-radius: 1.25rem;
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.04);
  }

  :global(.dark) .author-card {
    background: rgba(30, 30, 40, 0.45);
    border-color: rgba(255, 255, 255, 0.06);
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.15);
  }

  .author-social-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 12px;
    background: rgba(0, 0, 0, 0.06);
    color: #6b7280;
    transition: all 0.2s ease;
  }

  .author-social-btn:hover {
    background: rgba(56, 189, 248, 0.1);
    color: #0284c7;
    transform: translateY(-1px);
  }

  :global(.dark) .author-social-btn {
    background: rgba(255, 255, 255, 0.06);
    color: #9ca3af;
  }

  :global(.dark) .author-social-btn:hover {
    background: rgba(56, 189, 248, 0.12);
    color: #38bdf8;
  }

  .related-card {
    background: rgba(255, 255, 255, 0.35);
    border: 1px solid rgba(255, 255, 255, 0.4);
    backdrop-filter: blur(16px) saturate(1.3);
    -webkit-backdrop-filter: blur(16px) saturate(1.3);
    border-radius: 1.25rem;
    box-shadow: 0 2px 16px rgba(0, 0, 0, 0.03);
  }

  :global(.dark) .related-card {
    background: rgba(30, 30, 40, 0.4);
    border-color: rgba(255, 255, 255, 0.05);
    box-shadow: 0 2px 16px rgba(0, 0, 0, 0.12);
  }

  .floating-sidebar {
    position: absolute;
    top: 0;
    bottom: 0;
    right: 100%;
    margin-right: 2rem;
    width: 13rem;
  }

  @media (min-width: 1536px) {
    .floating-sidebar {
      margin-right: 2.5rem;
    }
  }

  .floating-toc {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 100%;
    margin-left: 2rem;
    width: 200px;
  }

  @media (min-width: 1536px) {
    .floating-toc {
      width: 230px;
      margin-left: 2.5rem;
    }
  }
</style>

<script>
  function initToc() {
    const allTocLinks = document.querySelectorAll<HTMLAnchorElement>('.toc-link');
    const progressBar = document.getElementById('toc-progress');
    if (allTocLinks.length === 0) return;

    // Only observe visible (non-hidden) TOC links
    const visibleLinks = Array.from(allTocLinks).filter((l) => !l.classList.contains('hidden'));
    const headingEls = visibleLinks.map((link) => {
      const slug = link.getAttribute('data-heading');
      return slug ? document.getElementById(slug) : null;
    }).filter(Boolean) as HTMLElement[];

    if (headingEls.length === 0) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const id = entry.target.id;

            allTocLinks.forEach((link) => {
              const isActive = link.getAttribute('data-heading') === id;
              if (isActive) {
                link.classList.add('text-primary', 'dark:text-primary-light', 'font-medium', 'bg-primary/[0.04]');
                link.classList.remove('text-gray-400', 'dark:text-gray-500');
              } else {
                link.classList.remove('text-primary', 'dark:text-primary-light', 'font-medium', 'bg-primary/[0.04]');
                link.classList.add('text-gray-400', 'dark:text-gray-500');
              }
            });

            if (progressBar) {
              const idx = headingEls.findIndex((el) => el.id === id);
              const pct = ((idx + 1) / headingEls.length) * 100;
              progressBar.style.width = `${pct}%`;
            }
          }
        });
      },
      { rootMargin: '-80px 0px -60% 0px', threshold: 0.1 }
    );

    headingEls.forEach((el) => observer.observe(el));

    // Re-init when language changes
    (window as any).__tocObserver?.disconnect();
    (window as any).__tocObserver = observer;
  }

  (window as any).initTocFn = initToc;
  initToc();
  document.addEventListener('astro:page-load', initToc);
</script>

<script>
  // Post-level language integration with global toggle
  // Note: innerHTML usage here is safe - content comes from Astro's own
  // server-rendered markdown (Content component), not user input.
  function initPostLang() {
    const contentEl = document.getElementById('post-content');
    const titleEl = document.getElementById('post-title');
    if (!contentEl) return;

    const hasEn = contentEl.dataset.hasEn === 'true';
    if (!hasEn) return;

    const titleKo = titleEl?.textContent || '';
    const titleEn = contentEl.dataset.titleEn || '';

    // Split server-rendered Astro markdown by delimiter
    const fullHtml = contentEl.innerHTML;
    const delimiter = '<!-- EN -->';
    const delimIdx = fullHtml.indexOf(delimiter);
    if (delimIdx === -1) return;

    const koHtml = fullHtml.slice(0, delimIdx).trim();
    const enHtml = fullHtml.slice(delimIdx + delimiter.length).trim();

    // Build DOM from trusted server content
    contentEl.textContent = '';
    const koDiv = document.createElement('div');
    koDiv.id = 'content-ko';
    koDiv.className = 'lang-content';
    const koTemplate = document.createElement('template');
    koTemplate.innerHTML = koHtml;
    koDiv.appendChild(koTemplate.content);

    const enDiv = document.createElement('div');
    enDiv.id = 'content-en';
    enDiv.className = 'lang-content lang-hidden';
    const enTemplate = document.createElement('template');
    enTemplate.innerHTML = enHtml;
    enDiv.appendChild(enTemplate.content);

    contentEl.appendChild(koDiv);
    contentEl.appendChild(enDiv);

    function setPostLang(lang: string) {
      if (lang === 'en') {
        koDiv.classList.add('lang-hidden');
        koDiv.classList.remove('fade-in');
        enDiv.classList.remove('lang-hidden');
        enDiv.classList.add('fade-in');
        if (titleEl && titleEn) titleEl.textContent = titleEn;
      } else {
        enDiv.classList.add('lang-hidden');
        enDiv.classList.remove('fade-in');
        koDiv.classList.remove('lang-hidden');
        koDiv.classList.add('fade-in');
        if (titleEl) titleEl.textContent = titleKo;
      }

      // Switch TOC headings to match language
      document.querySelectorAll<HTMLElement>('.toc-link[data-lang], .toc-item[data-lang]').forEach((el) => {
        const linkLang = el.getAttribute('data-lang');
        if (linkLang === lang) {
          el.classList.remove('hidden');
        } else {
          el.classList.add('hidden');
        }
      });

      // Re-init TOC observer for the new language's headings
      if (typeof (window as any).initTocFn === 'function') {
        (window as any).initTocFn();
      }
    }

    // Init from current global language
    const saved = localStorage.getItem('preferred-lang') || 'ko';
    setPostLang(saved);

    // Listen for global language changes — abort previous to prevent accumulation
    if ((window as any).__postLangAC) (window as any).__postLangAC.abort();
    (window as any).__postLangAC = new AbortController();
    window.addEventListener('lang-changed', (e: any) => {
      setPostLang(e.detail.lang);
    }, { signal: (window as any).__postLangAC.signal });
  }

  initPostLang();
  document.addEventListener('astro:page-load', initPostLang);
</script>
